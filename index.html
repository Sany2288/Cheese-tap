<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Cheese Combat</title>
<style>
body { font-family: Arial; text-align:center; background:#fffbe7; margin:0; padding:0; }
#cheese { width:200px; cursor:pointer; margin-top:40px; transition:0.1s; }
#cheese:active { transform:scale(0.9); }
#score,#level { font-size:24px; margin:10px; }
#upgrades{ margin-top:30px; }
button { padding:10px 15px; margin:5px; font-size:16px; cursor:pointer; }
</style>
</head>
<body>
<h1>üßÄ Cheese Combat</h1>
<div id="score">–°–∏—Ä: 0</div>
<div id="level">–†—ñ–≤–µ–Ω—å: 1</div>
<img id="cheese" src="https://i.ibb.co/7SN7r0Y/cheese.png">
<br>
<button id="sync">–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏</button>

<h2>‚ö° –ê–ø–≥—Ä–µ–π–¥–∏</h2>
<div id="upgrades">
  <button id="buyMultiplier">–ö—É–ø–∏—Ç–∏ –º–Ω–æ–∂–Ω–∏–∫ (50)</button>
  <button id="buyFarmer">–ö—É–ø–∏—Ç–∏ –∞–≤—Ç–æ—Ñ–µ—Ä–º–µ—Ä–∞ (100)</button>
</div>

<script>
let score=0, multiplier=1, farmers=0, level=1;
const scoreDiv=document.getElementById("score");
const levelDiv=document.getElementById("level");
const cheese=document.getElementById("cheese");
const syncBtn=document.getElementById("sync");

function updateUI(){
  scoreDiv.innerText="–°–∏—Ä: "+score;
  level=Math.floor(score/100)+1;
  levelDiv.innerText="–†—ñ–≤–µ–Ω—å: "+level;
}

// Telegram WebApp
const tg=window.Telegram?.WebApp;
let user=null;
if(tg && tg.initDataUnsafe.user) user=tg.initDataUnsafe.user;

// –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å—Ç–∞–Ω –∑ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ
async function loadState(){
  if(!user) return;
  const res=await fetch("/player/"+user.id);
  if(res.ok){
    const data=await res.json();
    score=data.cheese||0;
    multiplier=data.multiplier||1;
    farmers=data.farmers||0;
    updateUI();
  }
}
loadState();

cheese.addEventListener("click",()=>{ score+=multiplier; updateUI(); });

document.getElementById("buyMultiplier").addEventListener("click",()=>{
  if(score>=50){ score-=50; multiplier++; updateUI(); } else alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ —Å–∏—Ä—É!");
});
document.getElementById("buyFarmer").addEventListener("click",()=>{
  if(score>=100){ score-=100; farmers++; updateUI(); } else alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ —Å–∏—Ä—É!");
});

// –ê–≤—Ç–æ—Ñ–µ—Ä–º–µ—Ä
setInterval(()=>{ if(farmers>0){ score+=farmers; updateUI(); } },1000);

// –í–∏–ø–∞–¥–∫–æ–≤–∏–π –±–æ–Ω—É—Å
setInterval(()=>{
  let bonus=Math.floor(Math.random()*16)+5;
  score+=bonus; updateUI();
},30000);

syncBtn.addEventListener("click", async()=>{
  if(!user){ alert("–í—ñ–¥–∫—Ä–∏–π —á–µ—Ä–µ–∑ Telegram"); return; }
  const res=await fetch("/update",{ method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({user_id:user.id,username:user.username,cheese:score,multiplier,farmers}) });
  const data=await res.json();
  alert("–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ! –ó–∞–≥–∞–ª–æ–º: "+data.total);
});
</script>
</body>
</html>
